我们观察数据范围，有 $a_i\ge2$，并且相邻两个 $a_x$ 和 $a_y$ 之和为质数，那么显然一奇一偶，而又为环，所以若有解 $n$ 必为偶数，且 $\sum[a_i\in\text{odd}]=\frac n2$。

那么，我们对于所有满足 $(a_x+a_y)\in\mathbb{P}$，连一条 $x\to y$ 的边。由于只能在奇数值和偶数值之间连边，于是显然是二分图，同时约定上文中的 $a_x\in\text{odd}$ 为左点，而 $a_y\in\text{even}$ 为右点。

与通常的二分图匹配不同的是，每个点可以连出两个边，于是将源点 $s$ 到左点 $i$ 的边 $s\to i$ 的容量设为 $2$，同样的，将右点 $j$ 到汇点 $t$ 的边 $j\to t$ 的容量设为 $2$。

那么，若有解，最后一定能匹配 $n$ 条边。

对于最后的构造方案，我们可以枚举每个左点，并在残量网络上跑 dfs 即可。