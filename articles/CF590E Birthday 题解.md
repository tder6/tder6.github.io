前置知识：[AC 自动机](https://www.luogu.com.cn/problem/P5357) & [最长反链](https://www.luogu.com.cn/problem/P4298)。

这里主要讲一下如何将两道题「拼起来」解决，顺便安利一下 `namespace` 的用法。

如果我们可以建出一个图，其中有一条 $i\to j$ 的边当且仅当 $s_i$ 是 $s_j$ 的子串，那么我们即可直接套用 [P4298](https://www.luogu.com.cn/problem/P4298) 的前两问的做法解决。

那么，现在问题转化成了如何求得子串关系，即我们需要用 $n$ 个模式串匹配 $n$ 个文本串。显然考虑 AC 自动机，先建出 Trie 树，再分别查询每个文本串，求出其所有子串。形式化的，我们将每个 $s_i$ 当作 [P5357](https://www.luogu.com.cn/problem/P5357) 中的「$S$」，若「$T_j$」出现次数不为 $0$，则显然「$T_j$」为「$S$」的子串，于是建一条 $j\to i$ 的边。

上文中带中文引号「」内均指原题中的变量名。

建完了图，我们直接跑一边 [P4298](https://www.luogu.com.cn/problem/P4298) 即可。

但是，这么多的子问题，而变量名难免重复，我们如何解决呢？难道要像 `int n1, n2, n3, pre1[N], pre2[N]` 这么难以理解吗？

不！我们有 `namespace`！

> Q：`namespace` 是什么？
>
> A：`namespace`（命名空间）主要用于**解决命名冲突**的问题，提供对代码的组织和管理。它允许将相关的类、函数、变量等组织在一起，以便更好地组织和重用代码。它可以将一组类或函数封装在一起，这样在使用这些类或函数时，可以通过命名空间前缀来避免命名冲突。

> Q：在 C++ 中怎么用？
> 
> A：例如，下面是一个命名空间的示例：
> 
> ```cpp
> namespace QwQ {  
>     int n, m;
>     int calc(int k) {
>         return (k + 1) / 2;
> }  
> namespace AwA {  
>     char n; string m;
>     int calc(char c) {
>         return c - 'a' + 1;
> }  
> ```
> 
> 在这个例子中，我们定义了 `QwQ` 和 `AwA` 两个命名空间。其中，分别在两个命名空间里定义了变量名相同但是类型不同的两个值 $n,m$，以及一个函数名相同但是功能不同的函数 $\text{calc}()$，它们**互不干涉**。
> 
> 当我们想要调用其中的变量和函数时，我们需要使用形如 `QwQ::` 的**前缀**来明确指出我们想要使用的是哪个命名空间中的值。