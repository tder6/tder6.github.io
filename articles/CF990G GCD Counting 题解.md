烂题，卡我空间。

---

对于一条链 $(d_1=u)\to d_2\to\cdots\to d_{m-1}\to(d_m=v)$，若其 $\gcd$ 为 $k$，则显然的 $a_{d_i}$ 均为 $k$ 的倍数。

我们不妨先预处理出每个 $g_k=\{i~|~(k~|~a_i)\}$，很容易想到可以枚举 $a_i$ 的因数反向处理。

我们枚举每个 $k$，则每个 $i\in g_k$ 是显然可取的。对于一条边 $u\to v$，若 $u\in g_k$ 且 $v\in g_k$，则这条边可取。由于给定的树，不难想到用并查集维护，将每条可取的边的两个节点合并即可。

我们最终会得到若干个连通块，接下来考虑如何统计答案。

对于一个大小为 $m$ 的连通块，即一条长度为 $m$ 的链 $(d_1=u)\to d_2\to\cdots\to d_{m-1}\to(d_m=v)$，我们取其一个子链，有 $\dfrac{m(m+1)}2$ 种方案。具体的，以 $d_1$ 为起点的共 $m$ 条，以 $d_2$ 为起点的共 $m-1$ 条，依次类推，则最终共 $\displaystyle\left(\sum_{i=1}^mi\right)=\frac{m(m+1)}2$ 种。特别需要注意，单个点也是满足条件的链。

于是我们便愉快的做完了，举个例子形象说明一下。

这是一棵树，此处直接用点权代替节点编号。

![](https://cdn.luogu.com.cn/upload/image_hosting/mru1nryc.png)

对于 $k=2$ 时，我们预处理的 $g_k=\{2,4,6,8,10,12,14,16\}$。

那么，不难发现我们可以有可取的链 $2\to6\to4\to8\to16$，其贡献为 $15$，以及 $10\to12$ 贡献为 $3$，和单独成链的 $14$ 贡献为 $1$。于是答案为 $15+3+1=19$。

最后分析一下复杂度，我们忽略并查集操作复杂度中的 $\alpha(n)$ 不计，复杂度为 $\displaystyle O\left(\sum\tau(a_i)\right)$。对于 $a_i\le2\times10^5$，$\tau(a_i)$ 不超过 $160$，因此极限复杂度大概是 $O(3.2\times10^7)$，甚至更少，显然可过。